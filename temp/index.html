<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real-Time Police Dashboard</title>
    <style>
        body {
            transition: background-color 0.5s ease;
            font-family: Arial, sans-serif;
            text-align: center;
            padding: 20px;
        }
        .alert-active {
            background-color: red;
            color: white;
        }
        #al {
            font-size: 24px;
            margin-top: 20px;
        }
    </style>
    <script type="module">
        // Import the necessary Firebase libraries
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-app.js";
        import { getFirestore, onSnapshot, collection, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/9.1.2/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAjDqJBcwjFU5Td0azl7CaVBLkAV-hKOR4",
            authDomain: "saheli-app-9088f.firebaseapp.com",
            projectId: "saheli-app-9088f",
            storageBucket: "saheli-app-9088f.appspot.com",
            messagingSenderId: "635325370689",
            appId: "1:635325370689:web:2422bbf26dbbe774c3d1c0",
            measurementId: "G-C5QWS480VV"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Create a query to get the most recent alert
        const alertsRef = collection(db, "alerts");
        const q = query(alertsRef, orderBy("timestamp", "desc"), limit(1));

        // Function to get the last displayed alert ID from local storage
        function getLastDisplayedAlertId() {
            return localStorage.getItem('lastDisplayedAlertId');
        }

        // Function to set the last displayed alert ID in local storage
        function setLastDisplayedAlertId(id) {
            localStorage.setItem('lastDisplayedAlertId', id);
        }

        // Listen for real-time updates from the Firestore collection
        onSnapshot(q, (snapshot) => {
            snapshot.docChanges().forEach((change) => {
                if (change.type === "added") {
                    const alertData = change.doc.data();
                    const alertId = change.doc.id;
                    const lastDisplayedAlertId = getLastDisplayedAlertId();

                    // Only display the alert if it's new and hasn't been displayed before
                    if (alertId !== lastDisplayedAlertId) {
                        displayAlert(alertData);
                        setLastDisplayedAlertId(alertId);
                    }
                }
            });
        });

        function displayAlert(alert) {
            document.getElementById("al").innerHTML = `${alert.message}`;
            document.body.classList.add('alert-active');
            setTimeout(() => {
                document.body.classList.remove('alert-active');
                document.getElementById("al").innerHTML = '';
            }, 10000);
        }
    </script>
</head>
<body>
    <h1>POLICE DASHBOARD</h1>
    <h2 id="al"></h2>
</body>
</html>